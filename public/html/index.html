<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
</head>
<body>
<main id="wrapper">
    <header>
        <h1>Welcome to Transcriber app</h1>
    </header>
    <div id="content">
    </div>
    <div id="currentSpeech">
    </div>
</main>
</body>
</html>



<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
<script>
	let currentElement = window.currentSpeech

    const recognition = new webkitSpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;

	recognition.onsoundend = function() {
	  console.log('sound has stopped being detected');
	}

	recognition.onspeechstart = function() {
  	  console.log('Speech has been detected');
	}
	
    recognition.onresult = function(event) { 
    	var final_transcript = ''
    	var interim_transcript = ''
    	for (var i = event.resultIndex; i < event.results.length; ++i) {
    	  console.log(event.results[i][0])	
	      if (event.results[i].isFinal) {
	        final_transcript += event.results[i][0].transcript;
	      } else {
	        interim_transcript += event.results[i][0].transcript + ' ';
	      }
	    }

	    let d = new Date()

	    if (interim_transcript) {
	    	console.log(interim_transcript, 'ww')
	    	currentElement.textContent = `${interim_transcript}`

	    }

	    if (final_transcript) {
	    	console.log('final', final_transcript)
	    	let finalElem = document.createElement('span')
	    	finalElem.textContent = `${d.toLocaleTimeString()} ${final_transcript}`
	    	content.appendChild(finalElem)
	    	currentElement.textContent = ''
	    	//responsiveVoice.speak(`${final_transcript}`)
	    }
    	
    }

    recognition.onend = function(event) {
    	console.log('finished')
    	//recognition.start()
    }

    recognition.onerror = function(event) {
    	console.log(event.error);
	};

    
    window.addEventListener('load', () => {
    	recognition.start()
    })

</script>